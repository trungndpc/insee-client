"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const { EventEmitter } = require('events');
class Queue extends EventEmitter {
    constructor(threads) {
        super();
        this.queue = [];
        this.threads = threads;
        this.concurrent = 0;
        this.on('done', this.doneTask);
    }
    push(task) {
        console.log('[queue log]---- add task at', new Date());
        // add to queue
        this.queue.push(task);
        this.runTask();
    }
    runTask() {
        if (this.queue.length > 0) {
            if (this.concurrent >= this.threads) {
                return;
            }
            this.concurrent += 1;
            this.emit('run', this.queue.shift());
        }
        else {
            console.log('[queue log]---- queue is empty at: ', new Date());
            this.emit('empty', 'empty');
        }
    }
    doneTask() {
        this.concurrent -= 1;
        this.runTask();
    }
}
exports.default = Queue;
