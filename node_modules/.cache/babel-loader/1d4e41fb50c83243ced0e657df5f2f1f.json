{"ast":null,"code":"import _classCallCheck from\"/home/trungnd2/Documents/project/new/insee-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/trungnd2/Documents/project/new/insee-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/trungnd2/Documents/project/new/insee-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/trungnd2/Documents/project/new/insee-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import Modal from\"react-responsive-modal\";import\"react-responsive-modal/styles.css\";import\"../popup/styles.scss\";import UploadFileUtil from\"../utils/UploadFileUtil\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var owlClass=\"popup\";var ERROR_LOCATION=-1;var SUCCESS_LOCATION=1;var ERROR_REALTIME_PHOTO_TIME_CREATED=-2;var RealtimePhotoWidget=/*#__PURE__*/function(_React$PureComponent){_inherits(RealtimePhotoWidget,_React$PureComponent);var _super=_createSuper(RealtimePhotoWidget);function RealtimePhotoWidget(props){var _this;_classCallCheck(this,RealtimePhotoWidget);_this=_super.call(this,props);_this.geoSuccessCallback=function(position){_this.setState({error:SUCCESS_LOCATION,location:{latitude:position.coords.latitude,longitude:position.coords.longitude},step:2});};_this.geoErrorCallback=function(error){_this.setState({error:ERROR_LOCATION,errorMsg:error.message});};_this.onClickOpenCamera=function(){_this.inputImgRef.click();_this.timeClick=new Date().getTime();};_this.checkValidLastModified=function(lastModified){return lastModified>=_this.timeClick;};_this.onImageChange=function(event){if(event.target.files&&event.target.files[0]){var img=event.target.files[0];_this.setState({image:URL.createObjectURL(img)});if(!_this.checkValidLastModified(img.lastModified)){_this.setState({error:ERROR_REALTIME_PHOTO_TIME_CREATED});}else{_this.setState({error:0});_this.drawImagCanvas(img,_this.state.location,img.lastModified);}}};_this.drawImagCanvas=function(file,location,lastModified){var reader=new FileReader();reader.readAsDataURL(file);reader.onloadend=function(e){var image=new Image();image.src=e.target.result;image.onload=function(ev){var canvas=document.getElementById('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');ctx.drawImage(image,0,0);ctx.font=\"bold 10px Arial\";ctx.fillRect(0,0,image.width,50);ctx.fillStyle=\"white\";ctx.fillText(\"Location: \".concat(location.latitude,\" - \").concat(location.longitude),20,20);ctx.fillText(\"Time: \".concat(new Date(lastModified).toLocaleString('vi')),20,35);var dataURL=canvas.toDataURL('image/jpeg');_this.setState({image:dataURL,step:3});};};};_this.dataURItoBlob=function(dataURI){var byteString=atob(dataURI.split(',')[1]);var mimeString=dataURI.split(',')[0].split(':')[1].split(';')[0];var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i);}return new Blob([ab],{type:mimeString});};_this.click2Upload=function(){UploadFileUtil.uploadImg(_this.dataURItoBlob(_this.state.image)).then(function(resp){if(resp.error==200){var json={url:resp.data,time:_this.timeClick,location:_this.state.location};_this.props.onSubmit(json);}});};_this.state={error:0,errorMsg:null,location:null,step:1,image:null};_this.count_request_location=0;_this.timeClick=0;return _this;}_createClass(RealtimePhotoWidget,[{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProp,nextState){if(nextProp.open==true&&this.props.open==false){if(navigator.geolocation&&this.count_request_location==0){this.count_request_location++;navigator.geolocation.getCurrentPosition(this.geoSuccessCallback,this.geoErrorCallback);}}return true;}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(Modal,{open:this.props.open,onClose:function onClose(){_this2.props.onClose();},center:true,showCloseIcon:false,styles:{modal:{background:\"rgba(242, 242, 242, 0.94)\",backdropFilter:\"blur(54.3656px)\",borderRadius:\"14px\",padding:\"0\",maxWidth:\"80%\"}},children:[/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"canvas\",{style:{display:'none'},id:\"canvas\"}),/*#__PURE__*/_jsx(\"input\",{style:{display:'none'},ref:function ref(e){return _this2.inputImgRef=e;},onChange:this.onImageChange,type:\"file\",accept:\"image/*\",capture:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:owlClass,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(owlClass,\"__wrapper\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(owlClass,\"__wrapper__title\"),children:\"Realtime Photo\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"\".concat(owlClass,\"__wrapper__desc\"),children:[/*#__PURE__*/_jsx(\"span\",{children:\"1. Ch\\u1EA5p nh\\u1EADn chia s\\u1EBD v\\u1ECB tr\\xED hi\\u1EC7n t\\u1EA1i \"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{children:\"2. Ch\\u1EE5p \\u1EA3nh tr\\u1EF1c ti\\u1EBFp\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"photo_preview\",children:this.state.image&&/*#__PURE__*/_jsxs(_Fragment,{children:[this.state.error==ERROR_REALTIME_PHOTO_TIME_CREATED&&/*#__PURE__*/_jsx(\"p\",{className:\"error_upload_photo\",children:\"Vui l\\xF2ng ch\\u1EE5p \\u1EA3nh, kh\\xF4ng ch\\u1ECDn \\u1EA3nh \\u0111\\xE3 c\\xF3\"}),/*#__PURE__*/_jsx(\"div\",{className:\"photo-upload-item\",children:/*#__PURE__*/_jsx(\"img\",{src:this.state.image})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(owlClass,\"__group-btn\"),children:[this.state.step==2&&(this.state.error!=ERROR_LOCATION?/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(owlClass,\"__group-btn__item right \").concat(this.state.error!=ERROR_LOCATION?'btn-active':'btn-disable'),onClick:this.onClickOpenCamera,children:\"Ch\\u1EE5p \\u1EA3nh\"}):/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(owlClass,\"__group-btn__item right btn-active\"),children:\"Vui l\\xF2ng ch\\u1EA5p nh\\u1EADn chia s\\u1EBB v\\u1ECB tr\\xED\"})),this.state.step==3&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(owlClass,\"__group-btn__item right btn-active\"),onClick:this.click2Upload,children:\"G\\u1EE7i \\u1EA3nh\"}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(owlClass,\"__group-btn__item right \"),onClick:this.onClickOpenCamera,children:\"Ch\\u1EE5p l\\u1EA1i\"})]})]})]})]});}}]);return RealtimePhotoWidget;}(React.PureComponent);export{RealtimePhotoWidget as default};","map":{"version":3,"sources":["/home/trungnd2/Documents/project/new/insee-client/src/widget/RealtimePhotoWidget.js"],"names":["React","Modal","UploadFileUtil","owlClass","ERROR_LOCATION","SUCCESS_LOCATION","ERROR_REALTIME_PHOTO_TIME_CREATED","RealtimePhotoWidget","props","geoSuccessCallback","position","setState","error","location","latitude","coords","longitude","step","geoErrorCallback","errorMsg","message","onClickOpenCamera","inputImgRef","click","timeClick","Date","getTime","checkValidLastModified","lastModified","onImageChange","event","target","files","img","image","URL","createObjectURL","drawImagCanvas","state","file","reader","FileReader","readAsDataURL","onloadend","e","Image","src","result","onload","ev","canvas","document","getElementById","width","height","ctx","getContext","drawImage","font","fillRect","fillStyle","fillText","toLocaleString","dataURL","toDataURL","dataURItoBlob","dataURI","byteString","atob","split","mimeString","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","Blob","type","click2Upload","uploadImg","then","resp","json","url","data","time","onSubmit","count_request_location","nextProp","nextState","open","navigator","geolocation","getCurrentPosition","onClose","modal","background","backdropFilter","borderRadius","padding","maxWidth","display","PureComponent"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Modal from \"react-responsive-modal\";\nimport \"react-responsive-modal/styles.css\";\nimport \"../popup/styles.scss\";\nimport UploadFileUtil from \"../utils/UploadFileUtil\";\n\n\nconst owlClass = \"popup\";\nconst ERROR_LOCATION = -1;\nconst SUCCESS_LOCATION = 1;\nconst ERROR_REALTIME_PHOTO_TIME_CREATED = -2;\nexport default class RealtimePhotoWidget extends React.PureComponent {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            error: 0,\n            errorMsg: null,\n            location: null,\n            step: 1,\n            image: null,\n        }\n        this.count_request_location = 0\n        this.timeClick = 0;\n    }\n\n    geoSuccessCallback = (position) => {\n        this.setState({\n            error: SUCCESS_LOCATION, location: {\n                latitude: position.coords.latitude,\n                longitude: position.coords.longitude\n            },\n            step: 2\n        })\n    }\n\n    geoErrorCallback = (error) => {\n        this.setState({ error: ERROR_LOCATION, errorMsg: error.message })\n    }\n\n    shouldComponentUpdate(nextProp, nextState) {\n        if (nextProp.open == true && this.props.open == false) {\n            if (navigator.geolocation && this.count_request_location == 0) {\n                this.count_request_location++;\n                navigator.geolocation.getCurrentPosition(this.geoSuccessCallback, this.geoErrorCallback);\n            }\n        }\n        return true;\n    }\n\n    onClickOpenCamera = () => {\n        this.inputImgRef.click()\n        this.timeClick = new Date().getTime();\n    }\n\n    checkValidLastModified = (lastModified) => {\n        return lastModified >= this.timeClick;\n    }\n\n    onImageChange = event => {\n        if (event.target.files && event.target.files[0]) {\n            let img = event.target.files[0];\n            this.setState({\n                image: URL.createObjectURL(img)\n            });\n            if (!this.checkValidLastModified(img.lastModified)) {\n                this.setState({ error: ERROR_REALTIME_PHOTO_TIME_CREATED })\n            } else {\n                this.setState({ error: 0 })\n                this.drawImagCanvas(img, this.state.location, img.lastModified)\n            }\n        }\n    };\n\n    drawImagCanvas = (file, location, lastModified) => {\n        var reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onloadend = (e) => {\n            var image = new Image();\n            image.src = e.target.result;\n            image.onload = (ev) => {\n                var canvas = document.getElementById('canvas');\n                canvas.width = image.width;\n                canvas.height = image.height;\n                var ctx = canvas.getContext('2d');\n                ctx.drawImage(image, 0, 0);\n                ctx.font = \"bold 10px Arial\"\n                ctx.fillRect(0, 0, image.width, 50);\n                ctx.fillStyle = \"white\";\n                ctx.fillText(`Location: ${location.latitude} - ${location.longitude}`, 20, 20);\n                ctx.fillText(`Time: ${new Date(lastModified).toLocaleString('vi')}`, 20, 35);\n                var dataURL = canvas.toDataURL('image/jpeg')\n                this.setState({ image: dataURL, step: 3 })\n            }\n        }\n    }\n\n    dataURItoBlob = (dataURI) => {\n        var byteString = atob(dataURI.split(',')[1]);\n        var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n        var ab = new ArrayBuffer(byteString.length);\n        var ia = new Uint8Array(ab);\n        for (var i = 0; i < byteString.length; i++) {\n            ia[i] = byteString.charCodeAt(i);\n        }\n        return new Blob([ab], { type: mimeString });\n    }\n\n    click2Upload = () => {\n        UploadFileUtil.uploadImg(this.dataURItoBlob(this.state.image))\n            .then(resp => {\n                if (resp.error == 200) {\n                    let json = {\n                        url: resp.data,\n                        time: this.timeClick,\n                        location: this.state.location\n                    }\n                    this.props.onSubmit(json)\n                }\n            })\n    }\n\n    render() {\n        return (\n            <Modal\n                open={this.props.open}\n                onClose={() => {\n                    this.props.onClose()\n                }}\n                center\n                showCloseIcon={false}\n                styles={{\n                    modal: {\n                        background: \"rgba(242, 242, 242, 0.94)\",\n                        backdropFilter: \"blur(54.3656px)\",\n                        borderRadius: \"14px\",\n                        padding: \"0\",\n                        maxWidth: \"80%\"\n                    },\n                }}\n            >\n                <>\n                    <canvas style={{ display: 'none' }} id=\"canvas\" />\n                    <input style={{ display: 'none' }} ref={e => this.inputImgRef = e} onChange={this.onImageChange} type=\"file\" accept=\"image/*\" capture></input>\n                </>\n                <div className={owlClass}>\n                    <div className={`${owlClass}__wrapper`}>\n                        <div className={`${owlClass}__wrapper__title`}>Realtime Photo</div>\n                        <p className={`${owlClass}__wrapper__desc`}>\n                            <span>1. Chấp nhận chia sẽ vị trí hiện tại </span>\n                            <br />\n                            <span>2. Chụp ảnh trực tiếp</span>\n                        </p>\n                    </div>\n                    <div className=\"photo_preview\">\n                        {this.state.image &&\n                            <>\n                                {this.state.error == ERROR_REALTIME_PHOTO_TIME_CREATED &&\n                                    <p className=\"error_upload_photo\">Vui lòng chụp ảnh, không chọn ảnh đã có</p>\n                                }\n                                <div className=\"photo-upload-item\">\n                                    <img src={this.state.image} />\n                                </div>\n                            </>\n                        }\n                    </div>\n                    <div className={`${owlClass}__group-btn`}>\n                        {this.state.step == 2 &&\n                            (\n                                this.state.error != ERROR_LOCATION ?\n                                    <div\n                                        className={`${owlClass}__group-btn__item right ${this.state.error != ERROR_LOCATION ? 'btn-active' : 'btn-disable'}`}\n                                        onClick={this.onClickOpenCamera}\n                                    >\n                                        Chụp ảnh\n                            </div>\n                                    :\n                                    <div\n                                        className={`${owlClass}__group-btn__item right btn-active`}\n                                    >\n                                        Vui lòng chấp nhận chia sẻ vị trí\n                            </div>\n                            )\n                        }\n                        {this.state.step == 3 &&\n                            <>\n                                <div\n                                    className={`${owlClass}__group-btn__item right btn-active`}\n                                    onClick={this.click2Upload}\n                                >\n                                    Gủi ảnh\n                                </div>\n                                <div\n                                    className={`${owlClass}__group-btn__item right `}\n                                    onClick={this.onClickOpenCamera}\n                                >\n                                    Chụp lại\n                                </div>\n                            </>\n                        }\n                    </div>\n                </div>\n            </Modal>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}