{"ast":null,"code":"var _jsxFileName = \"/home/trungnd2/Documents/project/new/insee-client/src/widget/RealtimePhotoWidget.js\";\nimport React from \"react\";\nimport Modal from \"react-responsive-modal\";\nimport \"react-responsive-modal/styles.css\";\nimport \"../popup/styles.scss\";\nimport UploadFileUtil from \"../utils/UploadFileUtil\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst owlClass = \"popup\";\nconst ERROR_LOCATION = -1;\nconst SUCCESS_LOCATION = 1;\nconst ERROR_REALTIME_PHOTO_TIME_CREATED = -2;\nexport default class RealtimePhotoWidget extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.geoSuccessCallback = position => {\n      this.setState({\n        error: SUCCESS_LOCATION,\n        location: {\n          latitude: position.coords.latitude,\n          longitude: position.coords.longitude\n        },\n        step: 2\n      });\n    };\n\n    this.geoErrorCallback = error => {\n      this.setState({\n        error: ERROR_LOCATION,\n        errorMsg: error.message\n      });\n    };\n\n    this.onClickOpenCamera = () => {\n      this.inputImgRef.click();\n      this.timeClick = new Date().getTime();\n    };\n\n    this.checkValidLastModified = lastModified => {\n      return lastModified >= this.timeClick;\n    };\n\n    this.onImageChange = event => {\n      if (event.target.files && event.target.files[0]) {\n        let img = event.target.files[0];\n        this.setState({\n          image: URL.createObjectURL(img)\n        });\n\n        if (!this.checkValidLastModified(img.lastModified)) {\n          this.setState({\n            error: ERROR_REALTIME_PHOTO_TIME_CREATED\n          });\n        } else {\n          this.drawImagCanvas(img, this.state.location, img.lastModified);\n        }\n      }\n    };\n\n    this.drawImagCanvas = (file, location, lastModified) => {\n      var reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onloadend = e => {\n        var image = new Image();\n        image.src = e.target.result;\n\n        image.onload = ev => {\n          var canvas = document.getElementById('canvas');\n          canvas.width = image.width;\n          canvas.height = image.height;\n          var ctx = canvas.getContext('2d');\n          ctx.drawImage(image, 0, 0);\n          ctx.font = \"bold 10px Arial\";\n          ctx.fillRect(0, 0, image.width, 50);\n          ctx.fillStyle = \"white\";\n          ctx.fillText(`Location: ${location.latitude} - ${location.longitude}`, 20, 20);\n          ctx.fillText(`Time: ${new Date(lastModified).toLocaleString('vi')}`, 20, 35);\n          var dataURL = canvas.toDataURL('image/jpeg');\n          this.setState({\n            image: dataURL,\n            step: 3\n          });\n        };\n      };\n    };\n\n    this.dataURItoBlob = dataURI => {\n      var byteString = atob(dataURI.split(',')[1]);\n      var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n      var ab = new ArrayBuffer(byteString.length);\n      var ia = new Uint8Array(ab);\n\n      for (var i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i);\n      }\n\n      return new Blob([ab], {\n        type: mimeString\n      });\n    };\n\n    this.click2Upload = () => {\n      UploadFileUtil.uploadImg(this.dataURItoBlob(this.state.image)).then(resp => {\n        if (resp.error == 200) {\n          let json = {\n            url: resp.data,\n            time: this.timeClick,\n            location: this.state.location\n          };\n          this.props.onSubmit(json);\n        }\n      });\n    };\n\n    this.state = {\n      error: 0,\n      errorMsg: null,\n      location: null,\n      step: 1,\n      image: null\n    };\n    this.timeClick = 0;\n  }\n\n  shouldComponentUpdate(nextProp, nextState) {\n    if (nextProp.open == true) {\n      if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(this.geoSuccessCallback, this.geoErrorCallback);\n      }\n    }\n\n    return true;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Modal, {\n      open: this.props.open,\n      onClose: () => {\n        this.props.onClose();\n      },\n      center: true,\n      showCloseIcon: false,\n      styles: {\n        modal: {\n          background: \"rgba(242, 242, 242, 0.94)\",\n          backdropFilter: \"blur(54.3656px)\",\n          borderRadius: \"14px\",\n          padding: \"0\",\n          maxWidth: \"80%\"\n        }\n      },\n      children: [/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n          style: {\n            display: 'none'\n          },\n          id: \"canvas\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: {\n            display: 'none'\n          },\n          ref: e => this.inputImgRef = e,\n          onChange: this.onImageChange,\n          type: \"file\",\n          accept: \"image/*\",\n          capture: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: owlClass,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${owlClass}__wrapper`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${owlClass}__wrapper__title`,\n            children: \"Realtime Photo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: `${owlClass}__wrapper__desc`,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"1. Ch\\u1EA5p nh\\u1EADn chia s\\u1EBD v\\u1ECB tr\\xED hi\\u1EC7n t\\u1EA1i \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"2. Ch\\u1EE5p \\u1EA3nh tr\\u1EF1c ti\\u1EBFp\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"photo_preview\",\n          children: this.state.image && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [this.state.error == ERROR_REALTIME_PHOTO_TIME_CREATED && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"error_upload_photo\",\n              children: \"Vui l\\xF2ng ch\\u1EE5p \\u1EA3nh, kh\\xF4ng ch\\u1ECDn \\u1EA3nh \\u0111\\xE3 c\\xF3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"photo-upload-item\",\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: this.state.image\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 158,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${owlClass}__group-btn`,\n          children: [this.state.step == 2 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${owlClass}__group-btn__item right ${this.state.error != ERROR_LOCATION ? 'btn-active' : 'btn-disable'}`,\n            onClick: this.onClickOpenCamera,\n            children: \"Ch\\u1EE5p \\u1EA3nh\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${owlClass}__group-btn__item right btn-active`,\n            children: \"Vui l\\xF2ng ch\\u1EA5p nh\\u1EADn chia s\\u1EBB v\\u1ECB tr\\xED\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 29\n          }, this), this.state.step == 3 && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `${owlClass}__group-btn__item right btn-active`,\n              onClick: this.click2Upload,\n              children: \"G\\u1EE7i \\u1EA3nh\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `${owlClass}__group-btn__item right `,\n              onClick: this.onClickOpenCamera,\n              children: \"Ch\\u1EE5p l\\u1EA1i\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/home/trungnd2/Documents/project/new/insee-client/src/widget/RealtimePhotoWidget.js"],"names":["React","Modal","UploadFileUtil","owlClass","ERROR_LOCATION","SUCCESS_LOCATION","ERROR_REALTIME_PHOTO_TIME_CREATED","RealtimePhotoWidget","PureComponent","constructor","props","geoSuccessCallback","position","setState","error","location","latitude","coords","longitude","step","geoErrorCallback","errorMsg","message","onClickOpenCamera","inputImgRef","click","timeClick","Date","getTime","checkValidLastModified","lastModified","onImageChange","event","target","files","img","image","URL","createObjectURL","drawImagCanvas","state","file","reader","FileReader","readAsDataURL","onloadend","e","Image","src","result","onload","ev","canvas","document","getElementById","width","height","ctx","getContext","drawImage","font","fillRect","fillStyle","fillText","toLocaleString","dataURL","toDataURL","dataURItoBlob","dataURI","byteString","atob","split","mimeString","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","Blob","type","click2Upload","uploadImg","then","resp","json","url","data","time","onSubmit","shouldComponentUpdate","nextProp","nextState","open","navigator","geolocation","getCurrentPosition","render","onClose","modal","background","backdropFilter","borderRadius","padding","maxWidth","display"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Modal from \"react-responsive-modal\";\nimport \"react-responsive-modal/styles.css\";\nimport \"../popup/styles.scss\";\nimport UploadFileUtil from \"../utils/UploadFileUtil\";\n\n\nconst owlClass = \"popup\";\nconst ERROR_LOCATION = -1;\nconst SUCCESS_LOCATION = 1;\nconst ERROR_REALTIME_PHOTO_TIME_CREATED = -2;\nexport default class RealtimePhotoWidget extends React.PureComponent {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            error: 0,\n            errorMsg: null,\n            location: null,\n            step: 1,\n            image: null,\n        }\n        this.timeClick = 0;\n    }\n\n    geoSuccessCallback = (position) => {\n        this.setState({\n            error: SUCCESS_LOCATION, location: {\n                latitude: position.coords.latitude,\n                longitude: position.coords.longitude\n            },\n            step: 2\n        })\n    }\n\n    geoErrorCallback = (error) => {\n        this.setState({ error: ERROR_LOCATION, errorMsg: error.message })\n    }\n\n    shouldComponentUpdate(nextProp, nextState) {\n        if (nextProp.open == true) {\n            if (navigator.geolocation) {\n                navigator.geolocation.getCurrentPosition(this.geoSuccessCallback, this.geoErrorCallback);\n            }\n        }\n        return true;\n    }\n\n    onClickOpenCamera = () => {\n        this.inputImgRef.click()\n        this.timeClick = new Date().getTime();\n    }\n\n    checkValidLastModified = (lastModified) => {\n        return lastModified >= this.timeClick;\n    }\n\n    onImageChange = event => {\n        if (event.target.files && event.target.files[0]) {\n            let img = event.target.files[0];\n            this.setState({\n                image: URL.createObjectURL(img)\n            });\n            if (!this.checkValidLastModified(img.lastModified)) {\n                this.setState({ error: ERROR_REALTIME_PHOTO_TIME_CREATED })\n            } else {\n                this.drawImagCanvas(img, this.state.location, img.lastModified)\n            }\n        }\n    };\n\n    drawImagCanvas = (file, location, lastModified) => {\n        var reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onloadend = (e) => {\n            var image = new Image();\n            image.src = e.target.result;\n            image.onload = (ev) => {\n                var canvas = document.getElementById('canvas');\n                canvas.width = image.width;\n                canvas.height = image.height;\n                var ctx = canvas.getContext('2d');\n                ctx.drawImage(image, 0, 0);\n                ctx.font = \"bold 10px Arial\"\n                ctx.fillRect(0, 0, image.width, 50);\n                ctx.fillStyle = \"white\";\n                ctx.fillText(`Location: ${location.latitude} - ${location.longitude}`, 20, 20);\n                ctx.fillText(`Time: ${new Date(lastModified).toLocaleString('vi')}`, 20, 35);\n                var dataURL = canvas.toDataURL('image/jpeg')\n                this.setState({ image: dataURL, step: 3 })\n            }\n        }\n    }\n\n    dataURItoBlob = (dataURI) => {\n        var byteString = atob(dataURI.split(',')[1]);\n        var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n        var ab = new ArrayBuffer(byteString.length);\n        var ia = new Uint8Array(ab);\n        for (var i = 0; i < byteString.length; i++) {\n            ia[i] = byteString.charCodeAt(i);\n        }\n        return new Blob([ab], { type: mimeString });\n    }\n\n    click2Upload = () => {\n        UploadFileUtil.uploadImg(this.dataURItoBlob(this.state.image))\n            .then(resp => {\n                if (resp.error == 200) {\n                    let json = {\n                        url: resp.data,\n                        time: this.timeClick,\n                        location: this.state.location\n                    }\n                    this.props.onSubmit(json)\n                }\n            })\n    }\n\n    render() {\n        return (\n            <Modal\n                open={this.props.open}\n                onClose={() => {\n                    this.props.onClose()\n                }}\n                center\n                showCloseIcon={false}\n                styles={{\n                    modal: {\n                        background: \"rgba(242, 242, 242, 0.94)\",\n                        backdropFilter: \"blur(54.3656px)\",\n                        borderRadius: \"14px\",\n                        padding: \"0\",\n                        maxWidth: \"80%\"\n                    },\n                }}\n            >\n                <>\n                    <canvas style={{ display: 'none' }} id=\"canvas\" />\n                    <input style={{ display: 'none' }} ref={e => this.inputImgRef = e} onChange={this.onImageChange} type=\"file\" accept=\"image/*\" capture></input>\n                </>\n                <div className={owlClass}>\n                    <div className={`${owlClass}__wrapper`}>\n                        <div className={`${owlClass}__wrapper__title`}>Realtime Photo</div>\n                        <p className={`${owlClass}__wrapper__desc`}>\n                            <span>1. Chấp nhận chia sẽ vị trí hiện tại </span>\n                            <br />\n                            <span>2. Chụp ảnh trực tiếp</span>\n                        </p>\n                    </div>\n                    <div className=\"photo_preview\">\n                        {this.state.image &&\n                            <>\n                                {this.state.error == ERROR_REALTIME_PHOTO_TIME_CREATED &&\n                                    <p className=\"error_upload_photo\">Vui lòng chụp ảnh, không chọn ảnh đã có</p>\n                                }\n                                <div className=\"photo-upload-item\">\n                                    <img src={this.state.image} />\n                                </div>\n                            </>\n                        }\n                    </div>\n                    <div className={`${owlClass}__group-btn`}>\n                        {this.state.step == 2 ?\n                            <div\n                                className={`${owlClass}__group-btn__item right ${this.state.error != ERROR_LOCATION ? 'btn-active' : 'btn-disable'}`}\n                                onClick={this.onClickOpenCamera}\n                            >\n                                Chụp ảnh\n                            </div>\n                            :\n                            <div\n                                className={`${owlClass}__group-btn__item right btn-active`}\n                            >\n                                Vui lòng chấp nhận chia sẻ vị trí\n                            </div>\n                        }\n                        {this.state.step == 3 &&\n                            <>\n                                <div\n                                    className={`${owlClass}__group-btn__item right btn-active`}\n                                    onClick={this.click2Upload}\n                                >\n                                    Gủi ảnh\n                                </div>\n                                <div\n                                    className={`${owlClass}__group-btn__item right `}\n                                    onClick={this.onClickOpenCamera}\n                                >\n                                    Chụp lại\n                                </div>\n                            </>\n                        }\n                    </div>\n                </div>\n            </Modal>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}